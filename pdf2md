#!/usr/bin/env -S uv run --script
# /// script
# requires-python = ">=3.10"
# dependencies = [
#     "marker-pdf",
# ]
# ///
"""
pdf2md - Convert PDF files to Markdown using marker-pdf

Usage:
    pdf2md input.pdf [output.md]

If output filename is not provided, uses input filename with .md extension.
"""

import sys
from pathlib import Path


def main():
    if len(sys.argv) < 2:
        print("Usage: pdf2md input.pdf [output.md]")
        sys.exit(1)

    input_path = Path(sys.argv[1])

    if not input_path.exists():
        print(f"Error: {input_path} not found!")
        sys.exit(1)

    # Determine output path
    if len(sys.argv) >= 3:
        output_path = Path(sys.argv[2])
    else:
        output_path = input_path.with_suffix('.md')

    print(f"Converting {input_path} to {output_path}...")

    # Import marker-pdf (will be auto-installed by uv)
    from marker.converters.pdf import PdfConverter
    from marker.models import create_model_dict
    from marker.output import text_from_rendered

    # Create converter with models
    print("Loading models...")
    converter = PdfConverter(artifact_dict=create_model_dict())

    # Convert PDF
    print("Converting PDF (this might take a minute)...")
    rendered = converter(str(input_path))
    full_text, _, images = text_from_rendered(rendered)

    # Write output
    output_path.write_text(full_text, encoding='utf-8')
    print(f"âœ“ Conversion complete! Output saved to {output_path}")


if __name__ == "__main__":
    main()
